!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var o=function(t){var e=i(t);return function(n){var o=t.map.queryRenderedFeatures(n.point,{layers:["msoa-highlight"]})[0];if(void 0!==o){var i=o.properties.msoa11cd;t.hasSuggestion()&&t.suggestion.getCode()==i?t.removeSuggestion():t.setSuggestion(function(t,e,n,o){return{map:t,createForm:e,properties:n,coordinates:o,timestamp:Date.now(),window:null,animation:null,animating:!1,getId:function(){return""+this.properties.msoa11cd+this.timestamp},getCode:function(){return this.properties.msoa11cd},getName:function(){return this.properties.msoa11hclnm},open:function(){var t=this;this.map.setPaintProperty("msoa-highlight","fill-opacity",["case",["==",["get","msoa11cd"],this.properties.msoa11cd],.2,0]),this.window=new mapboxgl.Popup({closeButton:!1}).setLngLat(this.coordinates).setDOMContent(this.createForm(this.properties)).addTo(this.map),this.window.on("close",function(){return t.clearAnimation()})},close:function(){null!==this.window&&this.window.remove()},deselect:function(){this.map.setPaintProperty("msoa-highlight","fill-opacity",0)},getAnimation:function(){var t="Sending ",e=0;return function(){3==e?(t="Sending ",e=0):(t+=".",e+=1),document.getElementById("statusmsg").innerHTML="",document.getElementById("statusmsg").innerHTML=t}},startAnimation:function(){this.animating||(this.animating=!0,this.animation=setInterval(this.getAnimation(),330))},endAnimation:function(t){this.animating&&(clearInterval(this.animation),this.animating=!1,document.getElementById("statusmsg").innerHTML=t)},clearAnimation:function(){this.animating&&(clearInterval(this.animation),this.animating=!1)}}}(t.map,e,o.properties,n.lngLat))}else t.hasSuggestion()&&t.removeSuggestion()}},i=function(t){var e=function(t){var e=document.getElementById("sendbutton");0==t.srcElement.value?(e.disabled=!0,e.style.background="#c0c0c0",e.style.borderColor="#c0c0c0"):(e.disabled=!1,e.style.background="#d06040",e.style.borderColor="#d06040")},n=function(){var e=t.getSuggestion().getId(),n=document.getElementById("msoa11cd").value,o=document.getElementById("msoa11nm").value,s=document.getElementById("msoa11hclnm").value,a=document.getElementById("suggestion").value,r=document.getElementById("reason").value;if(0!=n.length&&0!=o.length&&0!=s.length&&0!=a.length&&!(n.length>64||o.length>64||s.length>64||a.length>64||r.length>1024)){var u=document.getElementById("contentbox");u.innerHTML="",u.appendChild(i()),t.getSuggestion().startAnimation();var l=new FormData;l.append("msoa11cd",n),l.append("msoa11nm",o),l.append("msoa11hclnm",s),l.append("suggestion",a),l.append("reason",r);var g=new XMLHttpRequest;g.timeout=2e4,g.onload=function(){t.hasSuggestion()&&e==t.getSuggestion().getId()&&t.getSuggestion().endAnimation("All done!")},g.ontimeout=function(){t.hasSuggestion()&&e==t.getSuggestion().getId()&&t.getSuggestion().endAnimation("Could not reach the server.")},g.onerror=function(){t.hasSuggestion()&&e==t.getSuggestion().getId()&&t.getSuggestion().endAnimation("Could not reach the server.")},g.open("POST","/submit"),g.send(l)}},o=function(){t.closeAndRemoveSuggestion()},i=function(t){var e=document.createElement("div");return e.className="statusbox",e.innerHTML='\n\t\t\t<p>Thank you very much for your suggestion for this area.</p>\n\t\t\t<p id="statusmsg">Sending </p>\n\t\t\t<button class="closebutton" type="button">Close</button>',e.getElementsByClassName("closebutton")[0].addEventListener("click",o,!1),e};return function(t){var i='\n\t\t\t<form method="post" action="/submit">\n\t\t\t\t<input type="hidden" id="msoa11cd"\n\t\t\t\t\tvalue="'+t.msoa11cd+'">\n\t\t\t\t<input type="hidden" id="msoa11nm"\n\t\t\t\t\t\tvalue="'+t.msoa11nm+'">\n\t\t\t\t<input type="hidden" id="msoa11hclnm"\n\t\t\t\t\t\tvalue="'+t.msoa11hclnm+'">\n\t\t\t\t<div id="namebox">\n\t\t\t\t\t<p>'+t.msoa11hclnm+'</p>\n\t\t\t\t</div>\n\t\t\t\t<div id="contentbox">\n\t\t\t\t    <div>\n\t\t\t\t        <input type="text" id="suggestion" class="suggestion"\n\t\t\t\t\t\t\tplaceholder="Your suggestion (required)" maxlength="64" required>\n\t\t\t\t    </div>\n\t\t\t\t    <div>\n\t\t\t\t        <textarea id="reason" placeholder="Why you think this would be a better name"\n\t\t\t\t\t\t\tmaxlength="1024"></textarea>\n\t\t\t\t    </div>\n\t\t\t\t    <div class="buttonbox">\n\t\t\t\t\t\t<button id="sendbutton" class="sendbutton"\n\t\t\t\t\t\t\ttype="button" disabled>Submit</button>\n\t\t\t\t        <button class="closebutton"\n\t\t\t\t\t\t\ttype="button">Close</button>\n\t\t\t\t    </div>\n\t\t\t\t\t<div id="messagebox">\n\t\t\t\t\t\t<p>Please note that we cannot accept suggestions for boundary changes.</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</form>',s=document.createElement("div");return s.className="formbox",s.innerHTML=i,s.getElementsByClassName("suggestion")[0].addEventListener("input",e,!1),s.getElementsByClassName("sendbutton")[0].addEventListener("click",n,!1),s.getElementsByClassName("closebutton")[0].addEventListener("click",o,!1),s}};console.log("Hello Noel: this version uses UWSGI."),function(t){return{suggestion:null,map:t,run:function(){var e=this;return t.addControl(new mapboxgl.NavigationControl,"top-right"),t.getCanvas().style.cursor="pointer",this.map.on("load",function(){t.addSource("msoa",{type:"vector",url:"mapbox://hawkinsohocl.dqzrnokh"}),t.addLayer({id:"msoa-highlight",type:"fill",source:"msoa","source-layer":"msoa-2011-polygons-hcl-0qsdgc",paint:{"fill-color":"#d83808","fill-opacity":0},minzoom:8,maxzoom:22})}),t.on("click",o(this)),t.on("zoom",function(){t.getZoom()<8&&e.hasSuggestion()&&e.closeAndRemoveSuggestion()}),this},getSuggestion:function(t){return this.suggestion},setSuggestion:function(t){return this.suggestion=t,this.suggestion.open(),this},removeSuggestion:function(){return this.suggestion.clearAnimation(),this.suggestion.deselect(),this.suggestion=null,this},closeAndRemoveSuggestion:function(){return this.suggestion.close(),this.removeSuggestion(),this},hasSuggestion:function(){return null!==this.suggestion}}}((mapboxgl.accessToken="pk.eyJ1IjoiaGF3a2luc29ob2NsIiwiYSI6IjNmMmZkMzY4MTUwZGNiMjE4NTExOWQwNDBjNzg4NjAzIn0.bv8BBlUo7MtQR544YviGZQ",new mapboxgl.Map({container:"map",style:"mapbox://styles/hawkinsohocl/cjkcm2ii04c9u2sqgjhzr0hwt"}))).run()}]);
//# sourceMappingURL=map.bundle.js.map