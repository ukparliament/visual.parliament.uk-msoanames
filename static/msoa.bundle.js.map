{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/msoa.js","webpack:///./src/start.js","webpack:///./src/map.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_start","_map","msoa","handleLocation","getQueryString","startMap","long","lat","map","createMap","createApp","run","window","acceptform","document","getElementById","acceptbutton","navigator","geolocation","getCurrentPosition","position","coords","longitude","toFixed","latitude","innerHTML","error","code","PERMISSION_DENIED","maximumAge","param","v","location","search","substring","split","length","createClickHandler","app","createForm","createFormFactory","e","feature","queryRenderedFeatures","point","layers","undefined","clickedCode","properties","msoa11cd","hasSuggestion","suggestion","getCode","removeSuggestion","setSuggestion","coordinates","timestamp","Date","now","animation","animating","getId","this","getName","msoa11hclnm","open","_this2","setPaintProperty","mapboxgl","Popup","closeButton","setLngLat","setDOMContent","addTo","on","clearAnimation","close","remove","deselect","getAnimation","output","startAnimation","setInterval","endAnimation","statusMsg","clearInterval","createSuggestion","lngLat","suggestionHandler","sendButton","srcElement","disabled","style","background","borderColor","sendHandler","sid","getSuggestion","msoa11nm","reason","contentBox","appendChild","createStatus","formData","FormData","append","request","XMLHttpRequest","timeout","onload","ontimeout","onerror","send","closeHandler","closeAndRemoveSuggestion","status","createElement","className","html","getElementsByClassName","addEventListener","form","accessToken","Map","container","center","zoom","_this","addControl","NavigationControl","getCanvas","cursor","addSource","type","url","addLayer","id","source","source-layer","paint","fill-color","fill-opacity","minzoom","maxzoom","getZoom"],"mappings":"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","file":"msoa.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { handleLocation, getQueryString } from \"./start.js\";\nimport { createMap , createApp } from \"./map.js\";\n\nconst msoa = {};\nmsoa.handleLocation = handleLocation;\nmsoa.getQueryString = getQueryString;\nmsoa.startMap = (long, lat) => {\n    const map = createMap(long, lat);\n    const app = createApp(map);\n    app.run();\n};\n\nwindow.msoa = msoa;\n","// Handle start-up -----------------------------------------------------------\n\nconst handleLocation = () => {\n    const acceptform = document.getElementById(\"acceptform\");\n    const acceptbutton = document.getElementById(\"acceptbutton\");\n    if (\"geolocation\" in navigator) {\n        navigator.geolocation.getCurrentPosition(\n            (position) => {\n                acceptform.long.value = position.coords.longitude.toFixed(6);\n                acceptform.lat.value = position.coords.latitude.toFixed(6);\n                acceptbutton.innerHTML = \"Accept and go to my location\";\n            },\n            (error) => {\n                if (error.code == error.PERMISSION_DENIED) {\n                    acceptbutton.innerHTML = \"Accept and continue\";\n                }\n            },\n            { maximumAge: 300000 }\n        );\n    }\n};\n\nconst getQueryString = (param) => {\n    const qs = window.location.search.substring(1);\n    const v = qs.split(\"&\");\n    for (let i = 0; i < v.length; i++) {\n        const p = v[i].split(\"=\");\n        if (p[\"0\"] == param) return p[\"1\"];\n    }\n    return null;\n};\n\n// Exports -------------------------------------------------------------------\nexport { handleLocation, getQueryString };\n","/* global mapboxgl */\n\n// Factories -----------------------------------------------------------------\nconst createMap = (long, lat) => {\n\n    const longitude = (long == null || long == false) ? -0.116773 : long;\n    const latitude = (lat == null || lat == false) ? 51.510357 : lat;\n\n    mapboxgl.accessToken =\n        \"pk.eyJ1IjoiaGF3a2luc29ob2NsIiwiYSI6IjNmMmZkMzY4MTUw\" +\n        \"ZGNiMjE4NTExOWQwNDBjNzg4NjAzIn0.bv8BBlUo7MtQR544YviGZQ\";\n\n    const map = new mapboxgl.Map({\n        container: \"map\",\n        style: \"mapbox://styles/hawkinsohocl/cjkcm2ii04c9u2sqgjhzr0hwt\",\n        center: [longitude, latitude],\n        zoom: 12.5\n    });\n\n    return map;\n};\n\nconst createApp = (map) => ({\n\n    suggestion: null,\n    map: map,\n\n    run() {\n\n        // Set up the map\n        map.addControl(new mapboxgl.NavigationControl(), \"top-right\");\n        // map.addControl(new mapboxgl.GeolocateControl({\n        //     showUserLocation: false,\n        //     fitBoundsOptions: {maxZoom: 12.5}\n        // }));\n        map.getCanvas().style.cursor = \"pointer\";\n\n        this.map.on(\"load\", () => {\n\n            map.addSource(\"msoa\", {\n                \"type\": \"vector\",\n                \"url\": \"mapbox://hawkinsohocl.dqzrnokh\"\n            });\n\n            map.addLayer({\n                \"id\": \"msoa-highlight\",\n                \"type\": \"fill\",\n                \"source\": \"msoa\",\n                \"source-layer\": \"msoa-2011-polygons-hcl-0qsdgc\",\n                \"paint\": {\n                    \"fill-color\": \"#d83808\",\n                    \"fill-opacity\": 0\n                },\n                \"minzoom\": 8,\n                \"maxzoom\": 22\n            });\n        });\n\n        map.on(\"click\", createClickHandler(this));\n\n        map.on(\"zoom\", () => {\n            if (map.getZoom() < 8 && this.hasSuggestion()) {\n                this.closeAndRemoveSuggestion();\n            }\n        });\n\n        return this;\n    },\n\n    getSuggestion() {\n        return this.suggestion;\n    },\n\n    setSuggestion(suggestion) {\n\n        this.suggestion = suggestion;\n        this.suggestion.open();\n        return this;\n    },\n\n    removeSuggestion() {\n\n        this.suggestion.clearAnimation();\n        this.suggestion.deselect();\n        this.suggestion = null;\n        return this;\n    },\n\n    closeAndRemoveSuggestion() {\n\n        this.suggestion.close();\n        this.removeSuggestion();\n        return this;\n    },\n\n    hasSuggestion() {\n        return this.suggestion !== null;\n    }\n});\n\nconst createSuggestion = (map, createForm, properties, coordinates) => ({\n\n    map: map,\n    createForm: createForm,\n    properties: properties,\n    coordinates: coordinates,\n    timestamp: Date.now(),\n    window: null,\n    animation: null,\n    animating: false,\n\n    getId() { return `${this.properties.msoa11cd}${this.timestamp}`; },\n    getCode() { return this.properties.msoa11cd; },\n    getName() { return this.properties.msoa11hclnm; },\n\n    open() {\n\n        // Highlight the suggestion's feature\n        this.map.setPaintProperty(\n            \"msoa-highlight\",\n            \"fill-opacity\",\n            [\"case\", [\"==\", [\"get\", \"msoa11cd\"],\n                this.properties.msoa11cd], 0.2, 0.0]);\n\n        // Open the suggestion window\n        this.window = new mapboxgl.Popup({closeButton: false})\n            .setLngLat(this.coordinates)\n            .setDOMContent(this.createForm(this.properties))\n            .addTo(this.map);\n\n        this.window.on(\"close\", () => this.clearAnimation());\n    },\n\n    close() {\n        // Close the suggestion window if it exists\n        if (this.window !== null) this.window.remove();\n    },\n\n    deselect() {\n        // Remove the highlight from the suggestion's feature\n        this.map.setPaintProperty(\"msoa-highlight\", \"fill-opacity\", 0.0);\n    },\n\n    getAnimation() {\n\n        const message = \"Sending \";\n        let output = message;\n        let i = 0;\n\n        return () => {\n\n            if (i == 3) {\n                output = message;\n                i = 0;\n            } else {\n                output += \".\";\n                i = i + 1;\n            }\n\n            document.getElementById(\"statusmsg\").innerHTML = \"\";\n            document.getElementById(\"statusmsg\").innerHTML = output;\n        };\n    },\n\n    startAnimation() {\n        if (! this.animating) {\n            this.animating = true;\n            this.animation = setInterval(this.getAnimation(), 330);\n        }\n    },\n\n    endAnimation(statusMsg) {\n        if (this.animating) {\n            clearInterval(this.animation);\n            this.animating = false;\n            document.getElementById(\"statusmsg\").innerHTML = statusMsg;\n        }\n    },\n\n    clearAnimation() {\n        if (this.animating) {\n            clearInterval(this.animation);\n            this.animating = false;\n        }\n    }\n});\n\nconst createClickHandler = (app) => {\n\n    const createForm = createFormFactory(app);\n\n    return (e) => {\n\n        // Get the feature under the pointer\n        const feature = app.map.queryRenderedFeatures(\n            e.point, {layers: [\"msoa-highlight\"]})[0];\n\n        // If there is no feature under the pointer just remove the suggestion\n        if (feature === undefined) {\n            if (app.hasSuggestion()) {\n                app.removeSuggestion();\n            }\n            return;\n        }\n\n        // Get the area code for the feature\n        const clickedCode = feature.properties.msoa11cd;\n\n        // If the click is on an open suggestion, remove it\n        if (app.hasSuggestion() &&\n            app.suggestion.getCode() == clickedCode) {\n            app.removeSuggestion();\n            return;\n        }\n\n        // Otherwise create a new suggestion\n        app.setSuggestion(createSuggestion(\n            app.map, createForm, feature.properties, e.lngLat));\n    };\n};\n\nconst createFormFactory = (app) => {\n\n    const suggestionHandler = (e) => {\n\n        const sendButton = document.getElementById(\"sendbutton\");\n\n        if (e.srcElement.value == 0) {\n\n            sendButton.disabled = true;\n            sendButton.style.background = \"#c0c0c0\";\n            sendButton.style.borderColor = \"#c0c0c0\";\n\n        } else{\n\n            sendButton.disabled = false;\n            sendButton.style.background = \"#d06040\";\n            sendButton.style.borderColor = \"#d06040\";\n        }\n    };\n\n    const sendHandler = () => {\n\n        const sid = app.getSuggestion().getId();\n        const msoa11cd = document.getElementById(\"msoa11cd\").value;\n        const msoa11nm = document.getElementById(\"msoa11nm\").value;\n        const msoa11hclnm = document.getElementById(\"msoa11hclnm\").value;\n        const suggestion = document.getElementById(\"suggestion\").value;\n        const reason = document.getElementById(\"reason\").value;\n\n        // Check input lengths are sane\n        if (msoa11cd.length == 0 || msoa11nm.length == 0 ||\n            msoa11hclnm.length == 0 || suggestion.length == 0 ) {\n            return;\n        }\n\n        if (msoa11cd.length > 64 || msoa11nm.length > 64 ||\n            msoa11hclnm.length > 64 || suggestion.length > 64 ||\n            reason.length > 1024) {\n            return;\n        }\n\n        // Change the form content to the status box\n        const contentBox = document.getElementById(\"contentbox\");\n        contentBox.innerHTML = \"\";\n        contentBox.appendChild(createStatus());\n        app.getSuggestion().startAnimation();\n\n        // Send the request\n        const formData = new FormData();\n        formData.append(\"msoa11cd\", msoa11cd);\n        formData.append(\"msoa11nm\", msoa11nm);\n        formData.append(\"msoa11hclnm\", msoa11hclnm);\n        formData.append(\"suggestion\", suggestion);\n        formData.append(\"reason\", reason);\n\n        const request = new XMLHttpRequest();\n        request.timeout = 20000;\n\n        request.onload = () => {\n\n            if (app.hasSuggestion() && sid == app.getSuggestion().getId()) {\n                app.getSuggestion().endAnimation(\"All done!\");\n            }\n        };\n\n        request.ontimeout = () => {\n\n            if (app.hasSuggestion() && sid == app.getSuggestion().getId()) {\n                app.getSuggestion().endAnimation(\"Could not reach the server.\");\n            }\n        };\n\n        request.onerror = () => {\n\n            if (app.hasSuggestion() && sid == app.getSuggestion().getId()) {\n                app.getSuggestion().endAnimation(\"Could not reach the server.\");\n            }\n        };\n\n        request.open(\"POST\", \"/submit\");\n        request.send(formData);\n    };\n\n    const closeHandler = () => {\n        app.closeAndRemoveSuggestion();\n    };\n\n    const createStatus = () => {\n\n        const html = `\n            <p>Thank you very much for your suggestion for this area.</p>\n            <p id=\"statusmsg\">Sending </p>\n            <button class=\"closebutton\" type=\"button\">Close</button>`;\n\n        const status = document.createElement(\"div\");\n        status.className = \"statusbox\";\n        status.innerHTML = html;\n\n        const closeButton = status.getElementsByClassName(\"closebutton\")[0];\n        closeButton.addEventListener(\"click\", closeHandler, false);\n\n        return status;\n    };\n\n    return (properties) => {\n\n        const suggestion = \"Your suggestion (required)\";\n        const reason = \"Why you think this would be a good name\";\n        const message = \"Please note that we cannot accept suggestions for \" +\n            \"boundary changes.\";\n\n        const html = `\n            <form method=\"post\" action=\"/submit\">\n                <input type=\"hidden\" id=\"msoa11cd\"\n                    value=\"${properties.msoa11cd}\">\n                <input type=\"hidden\" id=\"msoa11nm\"\n                        value=\"${properties.msoa11nm}\">\n                <input type=\"hidden\" id=\"msoa11hclnm\"\n                        value=\"${properties.msoa11hclnm}\">\n                <div id=\"namebox\">\n                    <p>${properties.msoa11hclnm}</p>\n                </div>\n                <div id=\"contentbox\">\n                    <div>\n                        <input type=\"text\" id=\"suggestion\" class=\"suggestion\"\n                            placeholder=\"${suggestion}\" maxlength=\"64\" required>\n                    </div>\n                    <div>\n                        <textarea id=\"reason\" placeholder=\"${reason}\"\n                            maxlength=\"1024\"></textarea>\n                    </div>\n                    <div class=\"buttonbox\">\n                        <button id=\"sendbutton\" class=\"sendbutton\"\n                            type=\"button\" disabled>Submit</button>\n                        <button class=\"closebutton\"\n                            type=\"button\">Close</button>\n                    </div>\n                    <div id=\"messagebox\">\n                        <p>${message}</p>\n                    </div>\n                </div>\n            </form>`;\n\n        const form = document.createElement(\"div\");\n        form.className = \"formbox\";\n        form.innerHTML = html;\n\n        const suggestionInput = form.getElementsByClassName(\"suggestion\")[0];\n        suggestionInput.addEventListener(\"input\", suggestionHandler, false);\n\n        const sendButton = form.getElementsByClassName(\"sendbutton\")[0];\n        sendButton.addEventListener(\"click\", sendHandler, false);\n\n        const closeButton = form.getElementsByClassName(\"closebutton\")[0];\n        closeButton.addEventListener(\"click\", closeHandler, false);\n\n        return form;\n    };\n};\n\n// Exports -------------------------------------------------------------------\nexport { createMap, createApp };\n"],"sourceRoot":""}