{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/map.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","createClickHandler","app","createForm","createFormFactory","e","feature","map","queryRenderedFeatures","point","layers","undefined","clickedCode","properties","msoa11cd","hasSuggestion","suggestion","getCode","removeSuggestion","setSuggestion","coordinates","timestamp","Date","now","window","animation","animating","getId","this","getName","msoa11hclnm","open","_this2","setPaintProperty","mapboxgl","Popup","closeButton","setLngLat","setDOMContent","addTo","on","clearAnimation","close","remove","deselect","getAnimation","output","document","getElementById","innerHTML","startAnimation","setInterval","endAnimation","statusMsg","clearInterval","createSuggestion","lngLat","suggestionHandler","sendButton","srcElement","disabled","style","background","borderColor","sendHandler","sid","getSuggestion","msoa11nm","reason","length","contentBox","appendChild","createStatus","formData","FormData","append","request","XMLHttpRequest","timeout","onload","ontimeout","onerror","send","closeHandler","closeAndRemoveSuggestion","status","createElement","className","html","getElementsByClassName","addEventListener","form","console","log","run","_this","addControl","NavigationControl","getCanvas","cursor","addSource","type","url","addLayer","id","source","source-layer","paint","fill-color","fill-opacity","minzoom","maxzoom","getZoom","createApp","accessToken","Map","container"],"mappings":"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","file":"map.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// Front-end component\n\n// Factories -----------------------------------------------------------------\nconst createMap = () => {\n\n\tmapboxgl.accessToken =\n\t\t\"pk.eyJ1IjoiaGF3a2luc29ob2NsIiwiYSI6IjNmMmZkMzY4MTUw\" +\n\t\t\"ZGNiMjE4NTExOWQwNDBjNzg4NjAzIn0.bv8BBlUo7MtQR544YviGZQ\";\n\n\tconst map = new mapboxgl.Map({\n\t\tcontainer: \"map\",\n\t\tstyle: \"mapbox://styles/hawkinsohocl/cjkcm2ii04c9u2sqgjhzr0hwt\"\n\t});\n\n\treturn map;\n};\n\nconst createApp = (map) => ({\n\n\tsuggestion: null,\n\tmap: map,\n\n\trun() {\n\n\t\t// Set up the map\n\t\tmap.addControl(new mapboxgl.NavigationControl(), \"top-right\");\n\t\t// map.addControl(new mapboxgl.GeolocateControl({\n\t\t// \tshowUserLocation: false,\n\t\t// \tfitBoundsOptions: {maxZoom: 12.5}\n\t\t// }));\n\t\tmap.getCanvas().style.cursor = \"pointer\";\n\n\t\tthis.map.on(\"load\", () => {\n\n\t\t\tmap.addSource(\"msoa\", {\n\t\t        \"type\": \"vector\",\n\t\t        \"url\": \"mapbox://hawkinsohocl.dqzrnokh\"\n\t\t    });\n\n\t\t\tmap.addLayer({\n\t\t\t\t\"id\": \"msoa-highlight\",\n\t\t\t\t\"type\": \"fill\",\n\t\t\t\t\"source\": \"msoa\",\n\t\t\t\t\"source-layer\": \"msoa-2011-polygons-hcl-0qsdgc\",\n\t\t\t\t\"paint\": {\n\t\t\t\t\t\"fill-color\": \"#d83808\",\n\t\t\t\t\t\"fill-opacity\": 0\n\t\t\t\t},\n\t\t\t\t\"minzoom\": 8,\n\t\t\t\t\"maxzoom\": 22\n\t\t\t});\n\t\t});\n\n\t\tmap.on(\"click\", createClickHandler(this));\n\n\t\tmap.on('zoom', () => {\n\t\t\tif (map.getZoom() < 8 && this.hasSuggestion()) {\n\t\t\t\tthis.closeAndRemoveSuggestion();\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t},\n\n\tgetSuggestion(suggestion) {\n\t\treturn this.suggestion;\n\t},\n\n\tsetSuggestion(suggestion) {\n\n\t\tthis.suggestion = suggestion;\n\t\tthis.suggestion.open();\n\t\treturn this;\n\t},\n\n\tremoveSuggestion() {\n\n\t\tthis.suggestion.clearAnimation();\n\t\tthis.suggestion.deselect();\n\t\tthis.suggestion = null;\n\t\treturn this;\n\t},\n\n\tcloseAndRemoveSuggestion() {\n\n\t\tthis.suggestion.close();\n\t\tthis.removeSuggestion();\n\t\treturn this;\n\t},\n\n\thasSuggestion() {\n\t\treturn this.suggestion !== null;\n\t}\n});\n\nconst createSuggestion = (map, createForm, properties, coordinates) => ({\n\n\tmap: map,\n\tcreateForm: createForm,\n\tproperties: properties,\n\tcoordinates: coordinates,\n\ttimestamp: Date.now(),\n\twindow: null,\n\tanimation: null,\n\tanimating: false,\n\n\tgetId() { return `${this.properties.msoa11cd}${this.timestamp}` },\n\tgetCode() { return this.properties.msoa11cd; },\n\tgetName() { return this.properties.msoa11hclnm; },\n\n\topen() {\n\n\t\t// Highlight the suggestion's feature\n\t\tthis.map.setPaintProperty(\n\t\t\t\"msoa-highlight\",\n\t\t\t\"fill-opacity\",\n\t\t\t[\"case\", [\"==\", [\"get\", \"msoa11cd\"],\n\t\t\t\tthis.properties.msoa11cd], 0.2, 0.0]);\n\n\t\t// Open the suggestion window\n\t\tthis.window = new mapboxgl.Popup({closeButton: false})\n\t\t\t.setLngLat(this.coordinates)\n\t\t\t.setDOMContent(this.createForm(this.properties))\n\t\t\t.addTo(this.map);\n\n\t\tthis.window.on(\"close\", () => this.clearAnimation());\n\t},\n\n\tclose() {\n\t\t// Close the suggestion window if it exists\n\t\tif (this.window !== null) this.window.remove();\n\t},\n\n\tdeselect() {\n\t\t// Remove the highlight from the suggestion's feature\n\t\tthis.map.setPaintProperty(\"msoa-highlight\", \"fill-opacity\", 0.0);\n\t},\n\n\tgetAnimation() {\n\n\t\tconst message = \"Sending \";\n\t\tlet output = message;\n\t\tlet i = 0;\n\n\t\treturn () => {\n\n\t\t\tif (i == 3) {\n\t\t\t\toutput = message;\n\t\t\t\ti = 0;\n\t\t\t} else {\n\t\t\t\toutput += \".\";\n\t\t\t\ti = i + 1;\n\t\t\t}\n\n\t\t\tdocument.getElementById(\"statusmsg\").innerHTML = \"\";\n\t\t\tdocument.getElementById(\"statusmsg\").innerHTML = output;\n\t\t}\n\t},\n\n\tstartAnimation() {\n\t\tif (! this.animating) {\n\t\t\tthis.animating = true;\n\t\t\tthis.animation = setInterval(this.getAnimation(), 330);\n\t\t}\n\t},\n\n\tendAnimation(statusMsg) {\n\t\tif (this.animating) {\n\t\t\tclearInterval(this.animation);\n\t\t\tthis.animating = false;\n\t\t\tdocument.getElementById(\"statusmsg\").innerHTML = statusMsg;\n\t\t}\n\t},\n\n\tclearAnimation() {\n\t\tif (this.animating) {\n\t\t\tclearInterval(this.animation);\n\t\t\tthis.animating = false;\n\t\t}\n\t}\n});\n\nconst createClickHandler = (app) => {\n\n\tconst createForm = createFormFactory(app);\n\n\treturn (e) => {\n\n\t\t// Get the feature under the pointer\n\t\tconst feature = app.map.queryRenderedFeatures(\n\t\t\te.point, {layers: [\"msoa-highlight\"]})[0];\n\n\t\t// If there is no feature under the pointer just remove the suggestion\n\t\tif (feature === undefined) {\n\t\t\tif (app.hasSuggestion()) {\n\t\t\t\tapp.removeSuggestion();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Get the area code for the feature\n\t\tconst clickedCode = feature.properties.msoa11cd;\n\n\t\t// If the click is on an open suggestion, remove it\n\t\tif (app.hasSuggestion() &&\n\t\t\tapp.suggestion.getCode() == clickedCode) {\n\t\t\tapp.removeSuggestion();\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise create a new suggestion\n\t\tapp.setSuggestion(createSuggestion(\n\t\t\tapp.map, createForm, feature.properties, e.lngLat));\n\t};\n};\n\nconst createFormFactory = (app) => {\n\n\tconst suggestionHandler = (e) => {\n\n\t\tconst sendButton = document.getElementById(\"sendbutton\");\n\n\t\tif (e.srcElement.value == 0) {\n\n\t\t\tsendButton.disabled = true;\n\t\t\tsendButton.style.background = \"#c0c0c0\";\n\t\t\tsendButton.style.borderColor = \"#c0c0c0\";\n\n\t\t} else{\n\n\t\t\tsendButton.disabled = false;\n\t\t\tsendButton.style.background = \"#d06040\";\n\t\t\tsendButton.style.borderColor = \"#d06040\";\n\t\t}\n\t};\n\n\tconst sendHandler = () => {\n\n\t\tconst sid = app.getSuggestion().getId();\n\t\tconst msoa11cd = document.getElementById(\"msoa11cd\").value;\n\t\tconst msoa11nm = document.getElementById(\"msoa11nm\").value;\n\t\tconst msoa11hclnm = document.getElementById(\"msoa11hclnm\").value;\n\t\tconst suggestion = document.getElementById(\"suggestion\").value;\n\t\tconst reason = document.getElementById(\"reason\").value;\n\n\t\t// Check input lengths are sane\n\t\tif (msoa11cd.length == 0 || msoa11nm.length == 0 ||\n\t\t\tmsoa11hclnm.length == 0 || suggestion.length == 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (msoa11cd.length > 64 || msoa11nm.length > 64 ||\n\t\t\tmsoa11hclnm.length > 64 || suggestion.length > 64 ||\n\t\t\treason.length > 1024) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Change the form content to the status box\n\t\tconst contentBox = document.getElementById('contentbox');\n\t\tcontentBox.innerHTML = \"\";\n\t\tcontentBox.appendChild(createStatus());\n\t\tapp.getSuggestion().startAnimation();\n\n\t\t// Send the request\n\t\tconst formData = new FormData();\n\t\tformData.append(\"msoa11cd\", msoa11cd);\n\t\tformData.append(\"msoa11nm\", msoa11nm);\n\t\tformData.append(\"msoa11hclnm\", msoa11hclnm);\n\t\tformData.append(\"suggestion\", suggestion);\n\t\tformData.append(\"reason\", reason);\n\n\t\tconst request = new XMLHttpRequest();\n\t\trequest.timeout = 20000;\n\n\t\trequest.onload = () => {\n\n\t\t\tif (app.hasSuggestion() && sid == app.getSuggestion().getId()) {\n\t\t\t\tapp.getSuggestion().endAnimation(\"All done!\");\n\t\t\t}\n\t\t};\n\n\t\trequest.ontimeout = () => {\n\n\t\t\tif (app.hasSuggestion() && sid == app.getSuggestion().getId()) {\n\t\t\t\tapp.getSuggestion().endAnimation(\"Could not reach the server.\");\n\t\t\t}\n\t\t};\n\n\t\trequest.onerror = () => {\n\n\t\t\tif (app.hasSuggestion() && sid == app.getSuggestion().getId()) {\n\t\t\t\tapp.getSuggestion().endAnimation(\"Could not reach the server.\");\n\t\t\t}\n\t\t};\n\n\t\trequest.open(\"POST\", \"/submit\");\n\t\trequest.send(formData);\n\t};\n\n\tconst closeHandler = () => {\n\t\tapp.closeAndRemoveSuggestion();\n\t};\n\n\tconst createStatus = (suggestion) => {\n\n\t\tconst html = `\n\t\t\t<p>Thank you very much for your suggestion for this area.</p>\n\t\t\t<p id=\"statusmsg\">Sending </p>\n\t\t\t<button class=\"closebutton\" type=\"button\">Close</button>`;\n\n\t\tconst status = document.createElement(\"div\");\n\t\tstatus.className = \"statusbox\";\n\t\tstatus.innerHTML = html;\n\n\t\tconst closeButton = status.getElementsByClassName(\"closebutton\")[0];\n\t\tcloseButton.addEventListener(\"click\", closeHandler, false);\n\n\t\treturn status;\n\t}\n\n\treturn (properties) => {\n\n\t\tconst suggestion = \"Your suggestion (required)\";\n\t\tconst reason = \"Why you think this would be a better name\";\n\t\tconst message = \"Please note that we cannot accept suggestions for \" +\n\t\t\t\"boundary changes.\";\n\n\t\tconst html = `\n\t\t\t<form method=\"post\" action=\"/submit\">\n\t\t\t\t<input type=\"hidden\" id=\"msoa11cd\"\n\t\t\t\t\tvalue=\"${properties.msoa11cd}\">\n\t\t\t\t<input type=\"hidden\" id=\"msoa11nm\"\n\t\t\t\t\t\tvalue=\"${properties.msoa11nm}\">\n\t\t\t\t<input type=\"hidden\" id=\"msoa11hclnm\"\n\t\t\t\t\t\tvalue=\"${properties.msoa11hclnm}\">\n\t\t\t\t<div id=\"namebox\">\n\t\t\t\t\t<p>${properties.msoa11hclnm}</p>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"contentbox\">\n\t\t\t\t    <div>\n\t\t\t\t        <input type=\"text\" id=\"suggestion\" class=\"suggestion\"\n\t\t\t\t\t\t\tplaceholder=\"${suggestion}\" maxlength=\"64\" required>\n\t\t\t\t    </div>\n\t\t\t\t    <div>\n\t\t\t\t        <textarea id=\"reason\" placeholder=\"${reason}\"\n\t\t\t\t\t\t\tmaxlength=\"1024\"></textarea>\n\t\t\t\t    </div>\n\t\t\t\t    <div class=\"buttonbox\">\n\t\t\t\t\t\t<button id=\"sendbutton\" class=\"sendbutton\"\n\t\t\t\t\t\t\ttype=\"button\" disabled>Submit</button>\n\t\t\t\t        <button class=\"closebutton\"\n\t\t\t\t\t\t\ttype=\"button\">Close</button>\n\t\t\t\t    </div>\n\t\t\t\t\t<div id=\"messagebox\">\n\t\t\t\t\t\t<p>${message}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</form>`;\n\n\t\tconst form = document.createElement(\"div\");\n\t\tform.className = \"formbox\";\n\t\tform.innerHTML = html;\n\n\t\tconst suggestionInput = form.getElementsByClassName(\"suggestion\")[0];\n\t\tsuggestionInput.addEventListener(\"input\", suggestionHandler, false);\n\n\t\tconst sendButton = form.getElementsByClassName(\"sendbutton\")[0];\n\t\tsendButton.addEventListener(\"click\", sendHandler, false);\n\n\t\tconst closeButton = form.getElementsByClassName(\"closebutton\")[0];\n\t\tcloseButton.addEventListener(\"click\", closeHandler, false);\n\n\t\treturn form;\n\t};\n};\n\n// Main ----------------------------------------------------------------------\n\nconsole.log(\"Hello Noel: this version uses UWSGI.\")\nconst map = createMap();\nconst app = createApp(map);\napp.run();\n"],"sourceRoot":""}