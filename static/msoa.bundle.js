!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var o=n(1),i=n(2),r={};r.handleLocation=o.handleLocation,r.getQueryString=o.getQueryString,r.startMap=function(e,t,n,o,r){var a=(0,i.createMap)(e,t,n,o);(0,i.createApp)(e,a,r).run()},window.msoa=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.handleLocation=function(){var e=document.getElementById("acceptform"),t=document.getElementById("acceptbutton");"geolocation"in navigator&&navigator.geolocation.getCurrentPosition((function(n){e.long.value=n.coords.longitude.toFixed(6),e.lat.value=n.coords.latitude.toFixed(6),t.innerHTML="See MSOAs near me"}),(function(e){e.code==e.PERMISSION_DENIED&&(t.innerHTML="See a map of MSOAs")}),{maximumAge:3e5})},t.getQueryString=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e)return o[1]}return null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){var t=i(e);return function(n){var o=e.map.queryRenderedFeatures(n.point,{layers:["msoa-highlight"]})[0];if(void 0!==o){var i=o.properties.msoa11cd;e.hasSelection()&&e.selection.getCode()==i?e.removeSelection():e.setSelection(function(e,t,n,o){return{map:e,createMessage:t,properties:n,coordinates:o,window:null,getCode:function(){return this.properties.msoa11cd},getName:function(){return this.properties.msoa11hclnm},open:function(){this.map.setPaintProperty("msoa-highlight","fill-opacity",["case",["==",["get","msoa11cd"],this.properties.msoa11cd],.2,0]),this.window=new mapboxgl.Popup({closeButton:!1}).setLngLat(this.coordinates).setDOMContent(this.createMessage(this.properties)).addTo(this.map),this.window.on("close",(function(){}))},close:function(){null!==this.window&&this.window.remove()},deselect:function(){this.map.setPaintProperty("msoa-highlight","fill-opacity",0)}}}(e.map,t,o.properties,n.lngLat))}else e.hasSelection()&&e.removeSelection()}},i=function(e){var t=function(){e.closeAndRemoveSelection()};return function(n){var o='\n            <div id="namebox">\n                <p>'+n.msoa11hclnm+'</p>\n            </div>\n            <div id="contentbox">\n                <p>'+n.msoa11nm+"</p>\n                <p>"+n.msoa11cd+'</p>\n                <p>\n                    <a href="/msoanames/static/MSOA-Names-'+e.config.msoanamesVersion+'.xlsx">Excel</a> /\n                    <a href="/msoanames/static/MSOA-Names-'+e.config.msoanamesVersion+'.csv">CSV</a>\n                </p>\n            </div>\n            <div id="buttonbox">\n                <button class="closebutton" type="button">Close</button>\n            </div>',i=document.createElement("div");return i.className="messagebox",i.innerHTML=o,i.getElementsByClassName("closebutton")[0].addEventListener("click",t,!1),i}};t.createMap=function(e,t,n,o){var i=function(e,t){return null==e||0==e||isNaN(parseFloat(e))?t:parseFloat(e)},r=i(t,-.116773),a=i(n,51.510356),s=i(o,12.5);return mapboxgl.accessToken=e.mapboxAccessToken,new mapboxgl.Map({container:"map",style:e.mapboxStyleUrl,center:[r,a],zoom:s})},t.createApp=function(e,t,n){return{selection:null,config:e,map:t,csrf:n,run:function(){var n=this;return t.addControl(new mapboxgl.NavigationControl,"top-right"),t.getCanvas().style.cursor="pointer",this.map.on("load",(function(){t.addSource("msoa",{type:"vector",url:e.mapboxSourceUrl}),t.addLayer({id:"msoa-highlight",type:"fill",source:"msoa","source-layer":e.mapboxSourceName,paint:{"fill-color":"#682f7f","fill-opacity":0},minzoom:8.5,maxzoom:22})})),t.on("click",o(this)),t.on("zoom",(function(){t.getZoom()<8.5&&n.hasSelection()&&n.closeAndRemoveSelection()})),t.on("moveend",(function(){var e=t.getCenter(),n=t.getZoom(),o="/msoanames/map?long="+e.lng+"&lat="+e.lat+"&zoom="+n;history.replaceState(null,null,o)})),this},getSelection:function(){return this.selection},setSelection:function(e){return this.selection=e,this.selection.open(),this},removeSelection:function(){return this.selection.deselect(),this.selection=null,this},closeAndRemoveSelection:function(){return this.selection.close(),this.removeSelection(),this},hasSelection:function(){return null!==this.selection},getCSRF:function(){return this.csrf}}}}]);
//# sourceMappingURL=msoa.bundle.js.map